(function($) {
    "use strict";

    $(".preloader").fadeOut();
    // ============================================================== 
    // Theme options
    // ==============================================================     
    // ============================================================== 
    // sidebar-hover
    // ==============================================================

    // Add default value for topbartoggler to collapsed (prevent first sidebar openning)
    $(".topbartoggler").addClass("collapsed");

    // Add default value for left-sidebar check if menu open
    $(".left-sidebar").addClass("open");
    
    // Create an observer instance to check mobile or desktop
    var observer = new MutationObserver(function(mutations) {
        if($('#main-wrapper').attr("data-sidebartype") === 'full'){

            // Remove gray overlay next to the sidebar
            $(".sidebar-overlay").removeAttr("style");

            enable_touch_scroll();
        }
    });
    var config = { attributes: true, childList: true, characterData: true };
    var target = document.querySelector('#main-wrapper');
    observer.observe(target, config);

    

    /*// ? Check if click to close or open left menu
    $('.dropdown-toggle').on('click', function() {

        // Disable body scrolling (prevent sidebar to scroll body)
        $('body').css("overflow", "hidden");

        // Add gray overlay next to the sidebar
        $('.sidebar-overlay').css("position", "fixed");
        $('.sidebar-overlay').css("display", "block");
        $('.sidebar-overlay').css("background-color", "rgba(0,0,0,0.6)");
        $('.sidebar-overlay').css("width", "100%");
        $('.sidebar-overlay').css("height", "100%");
        $('.sidebar-overlay').css("z-index", "2");
    });

    // ? If close .. top menu but not the by the overlay
    $('.topbartoggler').on('click', function() {
        

        // ? Dont toggle left menu if top menu open
        if($('#navbarSupportedContent').hasClass('show')){

          // Remove gray overlay next to the sidebar
          $(".sidebar-overlay").removeAttr("style");

          // Enable body scrolling (prevent sidebar to scroll body)
          $("body").removeAttr("style");
  
          enable_touch_scroll();
  
          }
    });*/
    

    // Check if click to close or open left menu
    $('.sidebartoggler').on('click', function() {
        
        // If left menu open
        if($(".left-sidebar").hasClass('open')){

            // Show logo letter
            $('#logo-letter-first').hide();
            $('#logo-letter-last').hide();
        }else{

            // Hide logo letter
            $('#logo-letter-first').show();
            $('#logo-letter-last').show();
        }

        // Auto scroll to top if user scroll on the left menu and close it
        // ? const el = new SimpleBar(document.getElementById('data-simplebar'));
        // ? el.getScrollElement().scrollTop = 0;

        // Toggle open class
        $(".left-sidebar").toggleClass("open");
    });

    // Check mouseenter and mouseleave for the sidebar
    $(".left-sidebar").hover(
        function() {

            freeze();

            // Move logo and letter right
            $(".navbar-header").addClass("expand-logo");

            // Hide logo letter
            $('#logo-letter-first').show();
            $('#logo-letter-last').show();
            
        }, function() {

            unfreeze();

            // If menu open dont hide logo letter
            if(!$(".left-sidebar").hasClass('open')){

                // Show logo letter
                $('#logo-letter-first').hide();
                $('#logo-letter-last').hide();
            }

            // Move logo and letter left
            $(".navbar-header").removeClass("expand-logo");
        }
    );

    // Click on gray overlay (next left menu mobile)
    $('.sidebar-overlay').on('click', function() {

        // Remove gray overlay next to the sidebar
        $(".sidebar-overlay").removeAttr("style");

        // Enable body scrolling (prevent sidebar to scroll body)
        $("body").removeAttr("style");

        // ? Dont toggle left menu if top menu open
        if(!$('#navbarSupportedContent').hasClass('show')){

            // Toggle sidebar
            $("#main-wrapper").removeClass("show-sidebar");
            $(".nav-toggler i").toggleClass("ti-menu");
        }

        enable_touch_scroll();
    });

    // Click left menu open
    $(".topbartoggler").on('click', function() {
        
        // Check if sidebar open
        if ($("#main-wrapper").hasClass("show-sidebar")) {

            // Toggle sidebar
            $("#main-wrapper").toggleClass("show-sidebar");
            $(".nav-toggler i").toggleClass("ti-menu");

            // Remove gray overlay next to the sidebar
            $(".sidebar-overlay").removeAttr("style");

            // Enable body scrolling (prevent sidebar to scroll body)
            $("body").removeAttr("style");

			enable_touch_scroll();
        }
    });

    // This is for close icon when navigation open in mobile view
    $(".nav-toggler").on('click', function() {
        
        // Collapse topbartoggler if open (user profil)
        if (!($(".topbartoggler").hasClass("collapsed"))) {
            $('.topbartoggler').click();
        }

        // Toggle sidebar
        $("#main-wrapper").toggleClass("show-sidebar");
        $(".nav-toggler i").toggleClass("ti-menu");

        // If mobile sidebar open
		if ($("#main-wrapper").hasClass("show-sidebar")) {
            
            // Auto scroll to top if user scroll on the left menu and close it
            const el = new SimpleBar(document.getElementById('data-simplebar'));
            el.getScrollElement().scrollTop = 0;

            // Disable body scrolling (prevent sidebar to scroll body)
            $('body').css("overflow", "hidden");

            // Add gray overlay next to the sidebar
            $('.sidebar-overlay').css("position", "fixed");
            $('.sidebar-overlay').css("display", "block");
            $('.sidebar-overlay').css("background-color", "rgba(0,0,0,0.6)");
            $('.sidebar-overlay').css("width", "100%");
            $('.sidebar-overlay').css("height", "100%");
            $('.sidebar-overlay').css("z-index", "2");

            disable_touch_scroll();

		}else{

            // Remove gray overlay next to the sidebar
            $(".sidebar-overlay").removeAttr("style");

            // Enable body scrolling (prevent sidebar to scroll body)
            $("body").removeAttr("style");

			enable_touch_scroll();
		}
    });
    $(".nav-lock").on('click', function() {
        $("body").toggleClass("lock-nav");
        $(".nav-lock i").toggleClass("mdi-toggle-switch-off");
        $("body, .page-wrapper").trigger("resize");
    });
    $(".search-box a, .search-box .app-search .srh-btn").on('click', function() {
        $(".app-search").toggle(200);
        $(".app-search input").focus();
    });

    // ============================================================== 
    // Right sidebar options
    // ==============================================================
    $(function() {
        $(".service-panel-toggle").on('click', function() {
            $(".customizer").toggleClass('show-service-panel');

        });
        $('.page-wrapper').on('click', function() {
            $(".customizer").removeClass('show-service-panel');
        });
    });
    // ============================================================== 
    // This is for the floating labels
    // ============================================================== 
    $('.floating-labels .form-control').on('focus blur', function(e) {
        $(this).parents('.form-group').toggleClass('focused', (e.type === 'focus' || this.value.length > 0));
    }).trigger('blur');

    // ============================================================== 
    // Tooltip
    // ============================================================== 
    $(function() {
        $('[data-toggle="tooltip"]').tooltip();
    })
    // ============================================================== 
    //Popover
    // ============================================================== 
    $(function() {
        $('[data-toggle="popover"]').popover();
    })

    // ============================================================== 
    // Perfact scrollbar
    // ============================================================== 
    $('.message-center, .customizer-body, .scrollable').perfectScrollbar({
        wheelPropagation: !0
    });

    /*var ps = new PerfectScrollbar('.message-body');
    var ps = new PerfectScrollbar('.notifications');
    var ps = new PerfectScrollbar('.scroll-sidebar');
    var ps = new PerfectScrollbar('.customizer-body');*/

    // ============================================================== 
    // Resize all elements
    // ============================================================== 
    $("body, .page-wrapper").trigger("resize");
    $(".page-wrapper").show();
    // ============================================================== 
    // To do list
    // ============================================================== 
    $(".list-task li label").click(function() {
        $(this).toggleClass("task-done");
    });

    //****************************
    /* This is for the mini-sidebar if width is less then 1170*/
    //**************************** 
    var setsidebartype = function() {
        var width = (window.innerWidth > 0) ? window.innerWidth : this.screen.width;
        if (width < 1170) {
            $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
        } else {
            $("#main-wrapper").attr("data-sidebartype", "full");
        }
    };
    $(window).ready(setsidebartype);
    $(window).on("resize", setsidebartype);

    //****************************
    /* This is for sidebartoggler*/
    //****************************
    $('.sidebartoggler').on("click", function() {
        $("#main-wrapper").toggleClass("mini-sidebar");
        if ($("#main-wrapper").hasClass("mini-sidebar")) {
			//enable_wheel_scroll();
            $(".sidebartoggler").prop("checked", !0);
            $("#main-wrapper").attr("data-sidebartype", "mini-sidebar");
        } else {
			//disable_wheel_scroll();
            $(".sidebartoggler").prop("checked", !1);
            $("#main-wrapper").attr("data-sidebartype", "full");
        }
    });
	
    function disable_wheel_scroll(){

        // Check if exists addEventListener
        if (window.addEventListener) {

            // Disable wheel scroll by class
            var el = document.getElementsByClassName("page-wrapper");
            for (var k=0; k<el.length; k++){
                el[k].addEventListener('DOMMouseScroll', preventDefaults, false);
            }
            // Disable wheel scroll by id
            //var el = document.getElementById("page-wrapper");
            //el.addEventListener('DOMMouseScroll', preventDefaults, false);
            window.onmousewheel = document.onmousewheel = preventDefaults;
		    document.onkeydown = keydown;
        }
    }

    function enable_wheel_scroll(){

        // Check if exists removeEventListener
        if (window.removeEventListener) {

            // Enable wheel scroll by id
            var elem = document.getElementsByClassName("page-wrapper");
            for (var k=0; k<elem.length; k++){
                elem[k].removeEventListener('DOMMouseScroll', preventDefaults, false);
            }
            // Enable wheel scroll by id
            //var el = document.getElementById("page-wrapper");
            //el.removeEventListener('DOMMouseScroll', preventDefaults, false);
            window.onmousewheel = document.onmousewheel = document.onkeydown = null; 
        }
    }

	function disable_touch_scroll(){

        disable_wheel_scroll();

        // Check if exists addEventListener
        if (window.addEventListener) {

            // Disable touchmove for gray overlay and "body"
            var el1 = document.getElementsByClassName("sidebar-overlay");
            for (var k=0; k<el1.length; k++){
                //elem[k].addEventListener("touchstart", preventDefaults, false); 
                el1[k].addEventListener("touchmove", preventDefaults, false);
            }
            var el2 = document.getElementsByClassName("page-wrapper");
            for (var k=0; k<el2.length; k++){
                //elem2[k].addEventListener("touchstart", preventDefaults, false); 
                el2[k].addEventListener("touchmove", preventDefaults, false);
            }
        }
    }
    
	function enable_touch_scroll(){

        enable_wheel_scroll();

        // Check if exists removeEventListener
        if (window.removeEventListener) {

            // Enable touchmove for gray overlay and "body"
            var el1 = document.getElementsByClassName("sidebar-overlay");
            for (var k=0; k<el1.length; k++){
                //elem[k].removeEventListener("touchstart", preventDefaults, false); 
                el1[k].removeEventListener("touchmove", preventDefaults, false);
            }
            var el2 = document.getElementsByClassName("page-wrapper");
            for (var k=0; k<el2.length; k++){
                //elem2[k].addEventListener("touchstart", preventDefaults, false); 
                el2[k].removeEventListener("touchmove", preventDefaults, false);
            }
        }
    }

    // Freeze page content scrolling
    function freeze() {
        if($("html").css("position") != "fixed") {
            var top = $("html").scrollTop() ? $("html").scrollTop() : $("body").scrollTop();
            if(window.innerWidth > $("html").width()) {
                $("html").css("overflow-y", "scroll");
            }
            //$("html").css({"width": "100%", "height": "100%", "position": "fixed", "top": -top});
            $("html").css({"width": "100%", "height": "100%", "position": "fixed", "top": -top});
            $('.topbar').css('padding-top',top);  
        }
    }

    // Unfreeze page content scrolling
    function unfreeze() {
        if($("html").css("position") == "fixed") {
            var top = $("html").scrollTop() ? $("html").scrollTop() : $("body").scrollTop();
            $("html").css("position", "static");
            $("html, body").scrollTop(-parseInt($("html").css("top")));
            $("html").removeAttr('style');
            //$("html").css({"position": "", "width": "", "height": "", "top": "", "overflow-y": ""});

            // Prevent top banner going down for IE
            if (checkIE()) {
                $('.topbar').css('padding-top', top);
            }else{
                $('.topbar').css('padding-top', -top);
            }
        }
    }

    function checkIE(){
        var ua = window.navigator.userAgent;
        return /MSIE|Trident/.test(ua);
    }
    
    /*
    function preventDefaults(e){
        if(!e){ // IE7, IE8, Chrome, Safari 
            e = window.event; 
        }
        if(e.preventDefault) { //Chrome, Safari, Firefox
            e.preventDefault(); 
        } 
        e.returnValue = false; // IE7, IE8
    }*/
	
	function preventDefaults(e) {
		e = e || window.event;
		if (e.preventDefault)
			e.preventDefault();
		e.returnValue = false;  
    }
    
	var keys = [32,33,34,35,36,37,38,39,40];
	function keydown(e) {
		for (var i = keys.length; i--;) {
			if (e.keyCode === keys[i]) {
				preventDefaults(e);
				return;
			}
		}
	}	
})(jQuery );